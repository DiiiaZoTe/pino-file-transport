We are modifying the project a little bit. Instead of using pino mulitstream to create a pino logger, we will overhaul the project to create a pino file transport. This transport will basically export a pino target (which I believe is a stream). Instead of custom coding this stream, we will change the implementation to use sonicboom.
Basically we are scratching all the console stuff, but we are keeping how the file stuff should behave while integrating sonicboom as in:
- file rotation should still happen daily/hourly, not block the writes from sonicboom (so maybe using a pending writes buffer ??)
- file rotation should still happen when the file size exceeds the max size (100MB by default), 0 means no max size rotation
- file rotation should consider that multiple processes can be writing to the same file, so we need to handle that properly by using a lock mechanism to ensure that only one process is rotating the file at a time and that the other processes wait for the rotation to finish before writing (without losing any writes). Make sure that if rotation fails, some process goes and retry so we don't wait forever.
- archiving should still happen either hourly, daily, weekly, monthly, but we need to handle that properly by using a lock mechanism to ensure that only one process is archiving the files. We can use the same lock mechanism we have, with heartbeat to prevent if worker crashes. Also make sure that if archiving fails, some process waiting goes and retries. It would be good I think if each process try to acquire the lock to archive, but only the first one to acquire it will trigger the worker.
- retention should be the same as currently implemented with a number + unit to define the retention duration (change that name from period). Probably should behave exactly like the archive locking and worker mechanism.
- These are the expected options for the transport:
  "path",
  "rotation" { 
    maxSize (0 for no size rotation) 100* in MB,
    frequency "hourly" | "daily"* ,
    logging boolean false*
  },
  "archive" { 
    enabled boolean true*,
    path (relative to the log path),
    frequency "hourly" | "daily" | "weekly" | "monthly"* | "yealy",
    runOnCreation boolean true*,
    logging boolean false*
  }
  "retention" {
    enabled boolean true*,
    duration (check below),
    logging boolean false*
  }